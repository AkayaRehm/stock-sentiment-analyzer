<script>
  async function analyzeTicker() {
    const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
    if (!ticker) return alert("Please enter a ticker symbol.");

    document.getElementById('result').classList.remove('hidden');
    document.getElementById('tickerSymbol').innerText = ticker;
    document.getElementById('premarketData').innerText = 'Loading...';
    document.getElementById('newsList').innerHTML = '';
    document.getElementById('socialSentiment').innerText = 'Loading...';
    document.getElementById('confidenceBadge').innerHTML = '';

    try {
      const apiKey = 'f6a50a1590314ee4bd78e07227ac4bdd';
      const proxy = 'https://corsproxy.io/?';
      const url = `${proxy}${encodeURIComponent(`https://api.twelvedata.com/quote?symbol=${ticker}&apikey=${apiKey}`)}`;
      const response = await fetch(url);
      const data = await response.json();

      if (data.code) throw new Error(data.message);

      const price = parseFloat(data.close);
      const previousClose = parseFloat(data.previous_close);
      const volume = parseInt(data.volume.replace(/,/g, ''));

      const change = price - previousClose;
      const percentChange = ((change / previousClose) * 100).toFixed(2);

      const summary = `${ticker} is ${change >= 0 ? 'up' : 'down'} ${percentChange}% with volume: ${volume.toLocaleString()}`;
      document.getElementById('premarketData').innerText = summary;

      const confidence = percentChange >= 5 ? 'High Confidence Play'
                        : percentChange >= 2 ? 'Watchlist'
                        : 'Avoid Today';
      const badgeColor = percentChange >= 5 ? 'green'
                        : percentChange >= 2 ? 'yellow'
                        : 'red';

      document.getElementById('confidenceBadge').innerHTML =
        `<span class="bg-${badgeColor}-500 text-white px-3 py-1 rounded-full">${confidence}</span>`;
    } catch (err) {
      console.error('[Premarket Error]', err);
      document.getElementById('premarketData').innerText = 'Failed to fetch premarket data.';
    }

    document.getElementById('newsList').innerHTML = `<li>Live news coming next step...</li>`;
    document.getElementById('socialSentiment').innerText = `Reddit/Twitter analysis coming soon.`;
  }
</script>
