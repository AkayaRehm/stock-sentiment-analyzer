<script>
  async function analyzeTicker() {
    const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
    if (!ticker) return alert("Please enter a ticker symbol.");

    document.getElementById('result').classList.remove('hidden');
    document.getElementById('tickerSymbol').innerText = ticker;
    document.getElementById('premarketData').innerText = 'Loading...';
    document.getElementById('newsList').innerHTML = '';
    document.getElementById('socialSentiment').innerText = 'Loading...';
    document.getElementById('confidenceBadge').innerHTML = '';

    // === Premarket Data via Yahoo (with CORS Proxy) ===
    try {
      const yahooURL = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=1d&interval=1m&includePrePost=true`;
      const proxyURL = `https://api.allorigins.win/raw?url=${encodeURIComponent(yahooURL)}`;
      const response = await fetch(proxyURL);
      const data = await response.json();

      const result = data.chart.result[0];
      const meta = result.meta;

      const preMarketPrice = meta.regularMarketPrice;
      const previousClose = meta.chartPreviousClose;
      const volume = meta.regularMarketVolume;

      const change = preMarketPrice - previousClose;
      const percentChange = ((change / previousClose) * 100).toFixed(2);

      const premarketSummary = `${ticker} is ${change >= 0 ? 'up' : 'down'} ${percentChange}% in premarket with volume: ${volume.toLocaleString()}`;
      document.getElementById('premarketData').innerText = premarketSummary;

      // === Confidence Scoring (basic) ===
      const confidence = percentChange >= 5 ? 'High Confidence Play' : percentChange >= 2 ? 'Watchlist' : 'Avoid Today';
      const badgeColor = percentChange >= 5 ? 'green' : percentChange >= 2 ? 'yellow' : 'red';
      document.getElementById('confidenceBadge').innerHTML = `<span class="bg-${badgeColor}-500 text-white px-3 py-1 rounded-full">${confidence}</span>`;
    } catch (err) {
      console.error(err);
      document.getElementById('premarketData').innerText = 'Failed to fetch premarket data.';
    }

    // === Placeholder News & Social Sentiment ===
    document.getElementById('newsList').innerHTML = `<li>Live news coming next step...</li>`;
    document.getElementById('socialSentiment').innerText = `Reddit/Twitter analysis coming soon.`;
  }
</script>
